<Page
    x:Name="pageRoot"
    x:Class="VKSaver.Views.PlayerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:VKSaver.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:VKSaver.Controls"
    xmlns:i="using:Microsoft.Xaml.Interactivity" 
    xmlns:c="using:Microsoft.Xaml.Interactions.Core"
    mc:Ignorable="d"
    RequestedTheme="Dark"
    DataContext="{Binding PlayerVM, Source={StaticResource Locator}}">

    <Page.Resources>
        <Style x:Key="TitleTextBlock" TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
            <Setter Property="FontSize" Value="50"/>
            <Setter Property="FontWeight" Value="Light"/>
            <Setter Property="TextWrapping" Value="NoWrap"/>
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="TextLineBounds" Value="TrimToBaseline"/>
            <Setter Property="OpticalMarginAlignment" Value="TrimSideBearings"/>
        </Style>
        <Style x:Key="ArtistTextBlock" TargetType="TextBlock" BasedOn="{StaticResource TitleTextBlock}">
            <Setter Property="FontSize" Value="32"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        <Style x:Key="TimeTextBlock" TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
            <Setter Property="FontSize" Value="280"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="OpticalMarginAlignment" Value="None"/>
            <Setter Property="CharacterSpacing" Value="-50"/>
            <Setter Property="TextTrimming" Value="None"/>
            <Setter Property="TextWrapping" Value="NoWrap"/>
            <Setter Property="OpticalMarginAlignment" Value="TrimSideBearings"/>
            <Setter Property="TextLineBounds" Value="TrimToBaseline"/>
        </Style>             

        <Style x:Key="SliderStyle" TargetType="Slider">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid x:Name="HorizontalTemplate" Margin="{TemplateBinding Padding}">
                            <Grid.Resources>
                                <Style x:Key="SliderThumbStyle" TargetType="Thumb">
                                    <Setter Property="BorderThickness" Value="0.8"/>
                                    <Setter Property="BorderBrush" Value="{ThemeResource SliderThumbBorderThemeBrush}"/>
                                    <Setter Property="Background" Value="{ThemeResource SliderThumbBackgroundThemeBrush}"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Thumb">
                                                <Ellipse Fill="White" StrokeThickness="0"/>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Grid.Resources>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal"/>
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Fill" Storyboard.TargetName="HorizontalTrackRect">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SliderTrackDisabledBackgroundThemeBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="HorizontalThumb">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SliderThumbDisabledBackgroundThemeBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Fill" Storyboard.TargetName="TopTickBar">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SliderTickMarkOutsideDisabledForegroundThemeBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Fill" Storyboard.TargetName="HorizontalInlineTickBar">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SliderTickMarkInlineDisabledForegroundThemeBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Fill" Storyboard.TargetName="BottomTickBar">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SliderTickMarkOutsideDisabledForegroundThemeBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="10"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="10"/>
                            </Grid.RowDefinitions>
                            <Rectangle x:Name="HorizontalTrackRect" Grid.ColumnSpan="3" Fill="{TemplateBinding Background}" Grid.Row="1"/>
                            <Rectangle x:Name="HorizontalDecreaseRect" Grid.Row="1" Fill="{StaticResource TitleBrush}"/>
                            <TickBar x:Name="TopTickBar" Grid.ColumnSpan="3" Fill="{ThemeResource SliderTickmarkOutsideBackgroundThemeBrush}" Height="{ThemeResource SliderOutsideTickBarThemeHeight}" Margin="-4.5,0" Visibility="Collapsed"/>
                            <TickBar x:Name="HorizontalInlineTickBar" Grid.ColumnSpan="3" Fill="{ThemeResource SliderTickMarkInlineBackgroundThemeBrush}" Height="5" Margin="-4.5,0" Grid.Row="1" Visibility="Collapsed"/>
                            <TickBar x:Name="BottomTickBar" Grid.ColumnSpan="3" Fill="{ThemeResource SliderTickmarkOutsideBackgroundThemeBrush}" Height="{ThemeResource SliderOutsideTickBarThemeHeight}" Margin="-4.5,0" Grid.Row="2" Visibility="Collapsed"/>
                            <Thumb x:Name="HorizontalThumb" AutomationProperties.AccessibilityView="Raw" Background="{ThemeResource SliderThumbBackgroundThemeBrush}" Grid.Column="1" DataContext="{TemplateBinding Value}" Height="12" Grid.RowSpan="3" Style="{StaticResource SliderThumbStyle}" Width="12" VerticalAlignment="Center" Margin="0,0,0,1"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <DataTemplate x:Key="PlaylistItemTemplate">
            <Grid>
                <StackPanel>
                    <TextBlock Text="{Binding Title}" Style="{StaticResource BaseTextBlockStyle}" TextWrapping="NoWrap" FontWeight="Bold" FontSize="21.333" Foreground="Black"/>
                    <TextBlock TextWrapping="NoWrap" Text="{Binding Artist}" Style="{StaticResource BaseTextBlockStyle}" FontSize="18.667" Foreground="Black" Margin="0,5,0,0"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <Style x:Key="ListViewItemStyle1" TargetType="ListViewItem">
            <Setter Property="FontFamily" Value="{ThemeResource ContentControlThemeFontFamily}"/>
            <Setter Property="FontSize" Value="{ThemeResource ControlContentThemeFontSize}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="TabNavigation" Value="Local"/>
            <Setter Property="IsHoldingEnabled" Value="True"/>
            <Setter Property="Margin" Value="0,0,18,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <ListViewItemPresenter CheckHintBrush="{ThemeResource ListViewItemCheckHintThemeBrush}" CheckBrush="{ThemeResource ListViewItemCheckThemeBrush}" ContentMargin="40,10,40,15" ContentTransitions="{TemplateBinding ContentTransitions}" CheckSelectingBrush="{ThemeResource ListViewItemCheckSelectingThemeBrush}" DragForeground="{ThemeResource ListViewItemDragForegroundThemeBrush}" DragOpacity="{ThemeResource ListViewItemDragThemeOpacity}" DragBackground="{ThemeResource ListViewItemDragBackgroundThemeBrush}" DisabledOpacity="{ThemeResource ListViewItemDisabledThemeOpacity}" FocusBorderBrush="{ThemeResource ListViewItemFocusBorderThemeBrush}" HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" Padding="{TemplateBinding Padding}" PointerOverBackgroundMargin="1" PlaceholderBackground="{ThemeResource ListViewItemPlaceholderBackgroundThemeBrush}" PointerOverBackground="{ThemeResource ListViewItemPointerOverBackgroundThemeBrush}" ReorderHintOffset="{ThemeResource ListViewItemReorderHintThemeOffset}" SelectedPointerOverBorderBrush="{ThemeResource ListViewItemSelectedPointerOverBorderThemeBrush}" SelectionCheckMarkVisualEnabled="True" SelectedForeground="{ThemeResource ListViewItemSelectedForegroundThemeBrush}" SelectedPointerOverBackground="{ThemeResource ListViewItemSelectedPointerOverBackgroundThemeBrush}" SelectedBorderThickness="{ThemeResource ListViewItemCompactSelectedBorderThemeThickness}" SelectedBackground="{ThemeResource ListViewItemSelectedBackgroundThemeBrush}" VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" Margin="0,0,0,20"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Background="Black">
        <controls:PlayerBackground x:Name="PlBackground" ArtistImage="{Binding PlayerVM.ArtistImage, Source={StaticResource Locator}}"/>
        <Hub Header="ВКачай">
            <Hub.HeaderTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button  x:Name="backButton" Margin="-1,-1,39,0" Command="{Binding WindowsNavigationHelper.GoBackCommand, ElementName=pageRoot}"
                                Style="{StaticResource NavigationBackButtonNormalStyle}"
                                VerticalAlignment="Top"
                                AutomationProperties.Name="Back"
                                AutomationProperties.AutomationId="BackButton"
                                AutomationProperties.ItemType="Navigation Button"/>
                        <TextBlock x:Name="pageTitle" Text="{Binding}" Style="{StaticResource HeaderTextBlockStyle}" Grid.Column="1" 
                        IsHitTestVisible="false" TextWrapping="NoWrap" VerticalAlignment="Top"/>
                    </Grid>
                </DataTemplate>
            </Hub.HeaderTemplate>
            <HubSection Width="{Binding Converter={StaticResource ScreenWidthConverter}, ConverterParameter=-450}" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" Padding="0">
                <DataTemplate>
                    <Grid>
                        <StackPanel VerticalAlignment="Bottom" Opacity="0.5" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,10,0">
                            <TextBlock Text="{Binding DurationStart, Converter={StaticResource TimeConverter}}" FontSize="240" Style="{StaticResource TimeTextBlock}"/>
                            <TextBlock Text="|" FontSize="160" Style="{StaticResource TimeTextBlock}" Margin="30,0"/>
                            <TextBlock Text="{Binding Duration, Converter={StaticResource TimeConverter}}" FontSize="160" Style="{StaticResource TimeTextBlock}"/>
                        </StackPanel>                        
                        <TextBlock Text="{Binding DurationStart, Converter={StaticResource TimeConverter}}" Style="{StaticResource TimeTextBlock}" VerticalAlignment="Bottom" Opacity="0.4" HorizontalAlignment="Left" FontSize="400" Visibility="Collapsed"/>
                        <Grid VerticalAlignment="Bottom" Margin="120,0,0,120">
                            <Grid.ChildrenTransitions>
                                <TransitionCollection>
                                    <EntranceThemeTransition/>
                                </TransitionCollection>
                            </Grid.ChildrenTransitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid x:Name="AlbumImageBlock" Background="{StaticResource TitleBrush}" VerticalAlignment="Bottom" HorizontalAlignment="Left" Width="200" Height="200">
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Image Source="{Binding TrackImage}" Grid.RowSpan="2"/>
                            </Grid>
                            <StackPanel x:Name="OptionsButtonsPanel" 
                                    Grid.Column="1" 
                                    Orientation="Vertical" 
                                    VerticalAlignment="Bottom" 
                                    HorizontalAlignment="Left">
                                <StackPanel.ChildrenTransitions>
                                    <TransitionCollection>
                                        <EntranceThemeTransition/>
                                    </TransitionCollection>
                                </StackPanel.ChildrenTransitions>
                                <Button Content="&#xE0F4;" 
                                    Style="{StaticResource OptionButtonStyle}"
                                    Command="{Binding ShowTrackLyrics}"/>
                                <Button Content="&#xE118;" 
                                    Style="{StaticResource OptionButtonStyle}"
                                    Command="{Binding DownloadTrack}"/>
                                <ToggleButton Content="&#xE14B;" 
                                          Style="{StaticResource OptionToggleButtonStyle}" 
                                          IsChecked="{Binding IsShuffleMode, Mode=TwoWay}"
                                          IsEnabled="{Binding CanShuffle}"/>
                                <ToggleButton Content="&#xE149;" 
                                          Style="{StaticResource OptionToggleButtonStyle}" 
                                          IsChecked="{Binding IsRepeatMode, Mode=TwoWay}"/>
                            </StackPanel>
                            <TextBlock x:Name="TitleTB" Text="{Binding CurrentTrack.Title}" Style="{StaticResource TitleTextBlock}" Grid.Row="1" Grid.ColumnSpan="2" Margin="0,25,0,0"/>
                            <TextBlock x:Name="ArtistTB" Text="{Binding CurrentTrack.Artist}" Style="{StaticResource ArtistTextBlock}" Grid.Row="2" Grid.ColumnSpan="2" Margin="0,8,0,10"/>
                            <Slider x:Name="PositionSlider" Grid.Row="3" Value="{Binding LeftSeconds, Mode=TwoWay, UpdateSourceTrigger=Explicit}" Maximum="{Binding TotalSeconds}" Style="{StaticResource SliderStyle}" Margin="0,5,0,0" PointerReleased="Slider_PointerReleased">
                                <Slider.Foreground>
                                    <SolidColorBrush Color="{StaticResource AccentColor}"/>
                                </Slider.Foreground>
                                <Slider.Background>
                                    <SolidColorBrush Color="{StaticResource AccentColor}" Opacity="0.4"/>
                                </Slider.Background>
                            </Slider>
                            <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,5,0,0" Grid.ColumnSpan="2">
                                <StackPanel.ChildrenTransitions>
                                    <TransitionCollection>
                                        <EntranceThemeTransition/>
                                    </TransitionCollection>
                                </StackPanel.ChildrenTransitions>
                                <Button Style="{StaticResource PlayerGlyphButtonStyle}" 
                                    Content="&#xE100;"
                                    Command="{Binding PreviousTrack}"/>
                                <ToggleButton Style="{StaticResource PlayerGlyphToogleButonStyle}"
                                              Content=""
                                              Command="{Binding PlayResume}"  
                                              IsChecked="{Binding IsPlaying}"/>
                                <Button Style="{StaticResource PlayerGlyphButtonStyle}" 
                                    Content="&#xE101;"
                                    Command="{Binding NextTrack}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </DataTemplate>
            </HubSection>
            <HubSection Header="плейлист" Width="450" 
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch" Padding="40,-35,40,0" Background="#99FFFFFF" Foreground="Black">
                <DataTemplate>
                    <Grid>
                        <ListView 
                            x:Name="TracksList"
				            Style="{StaticResource NoSelectionListViewStyle}"
				            ItemsSource="{Binding Tracks}"
				            ItemTemplate="{StaticResource PlaylistItemTemplate}"
                            Loaded="TracksList_Loaded" ItemContainerStyle="{StaticResource ListViewItemStyle1}" Margin="-40,0">
                            <i:Interaction.Behaviors>
                                <c:EventTriggerBehavior EventName="ItemClick">
                                    <c:InvokeCommandAction 
                                    Command="{Binding PlayTrack}" 
                                    InputConverter="{Binding Source={StaticResource ItemClickEventArgsConverter}}"/>
                                </c:EventTriggerBehavior>
                            </i:Interaction.Behaviors>
                        </ListView>
                    </Grid>
                </DataTemplate>
            </HubSection>
        </Hub>
    </Grid>
</Page>
